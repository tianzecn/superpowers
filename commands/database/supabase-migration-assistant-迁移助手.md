---
allowed-tools: Read, Write, Edit, Bash
argument-hint: [migration-type] | --create | --alter | --seed | --rollback
description: 生成并管理 Supabase 数据库迁移，支持自动化测试和验证
---

# Supabase 迁移助手

生成并管理 Supabase 迁移，包含全面的测试和验证：**$ARGUMENTS**

## 当前迁移上下文

- Supabase 项目：用于迁移管理和验证的 MCP 集成
- 迁移文件：!`find . -name "*migrations*" -type d -o -name "*.sql" | head -5` 现有迁移结构
- 架构版本：当前数据库架构状态和迁移历史
- 本地更改：!`git diff --name-only | grep -E "\\.sql$|\\.ts$" | head -3` 待处理的数据库修改

## 任务

执行综合迁移管理，包含自动化验证和测试：

**迁移类型**：使用 $ARGUMENTS 指定表创建、架构更改、数据种子或迁移回滚

**迁移管理框架**：
1. **迁移规划** - 分析架构需求、设计迁移策略、识别依赖关系、规划回滚流程
2. **代码生成** - 生成迁移 SQL 文件、创建 TypeScript 类型、实施安全检查、优化执行顺序
3. **验证测试** - 在开发数据上测试迁移、验证架构更改、验证数据完整性、检查约束违规
4. **Supabase 集成** - 通过 MCP 服务器应用迁移、监控执行状态、处理错误条件、验证最终状态
5. **类型生成** - 生成 TypeScript 类型、更新应用程序接口、与客户端架构同步、保持类型安全
6. **回滚策略** - 创建回滚迁移、测试回滚流程、实施数据保护、验证恢复过程

**高级功能**：自动化类型生成、迁移测试、性能影响分析、团队协作、CI/CD 集成。

**安全措施**：迁移前备份、演练验证、回滚测试、数据完整性检查、性能监控。

**输出**：完整的迁移套件，包含 SQL 文件、TypeScript 类型、测试验证、回滚流程和部署文档。
